<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sistema de AnÃ¡lise de Investimentos â€“ FIFO + HistÃ³rico</title>
<link rel="stylesheet" href="styles.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
<div class="container">
<h1>ğŸ“Š Sistema de AnÃ¡lise de Investimentos â€“ FIFO + HistÃ³rico Completo</h1>

<div class="controls">
  <button onclick="loadExcel()">ğŸ“‚ Carregar carteira-export.xlsx</button>
  <button onclick="updateRealTimePrices()" id="updatePricesBtn" disabled>ğŸ”„ Atualizar PreÃ§os</button>
  <button onclick="exportReport()" class="btn-export" id="exportBtn" disabled>ğŸ“¤ Exportar RelatÃ³rio JSON</button>
  <button onclick="exportExcel()" class="btn-export" id="exportExcelBtn" disabled>ğŸ“¥ Exportar XLSX</button>
  <label>ğŸ¦ Caixa Renda Fixa (BRL): <input type="number" id="fixedIncomeInput" step="0.01" value="0"></label>
</div>

<div id="statusMessage" class="status-message info"></div>
<div id="summaryCards" class="summary-cards"></div>

<div class="tabs" id="tabs" style="display:none;">
  <button class="tab-btn active" onclick="switchTab('resumo')">ğŸ“Š Resumo</button>
  <button class="tab-btn" onclick="switchTab('ativos')">ğŸ“ˆ Ativos Atuais</button>
  <button class="tab-btn" onclick="switchTab('todos')">ğŸ“‹ Todos os Ativos</button>
  <button class="tab-btn" onclick="switchTab('trades')">ğŸ’¹ Trades Realizados</button>
  <button class="tab-btn" onclick="switchTab('historico')">ğŸ” HistÃ³rico Completo</button>
</div>

<!-- ABA RESUMO -->
<div id="resumo" class="tab-content active">
  <div id="categoryChartContainer" style="display:none;margin-bottom:30px;background:#161b22;padding:20px;border-radius:10px;">
    <h2>ComposiÃ§Ã£o da Carteira (Valor Atual)</h2>
    <div style="position:relative;height:400px;">
      <canvas id="categoryChart"></canvas>
    </div>
  </div>

  <div id="categorySummaryContainer" style="display:none;">
    <h2>Resumo por Categoria</h2>
    <div class="table-container">
      <table>
        <thead><tr>
          <th>Categoria</th>
          <th class="num-col">Qtd Ativos</th>
          <th class="num-col">Valor Investido</th>
          <th class="num-col">Valor Atual</th>
          <th class="num-col">Lucro Realizado</th>
          <th class="num-col">Lucro Aberto</th>
          <th class="num-col">Lucro Total</th>
          <th class="num-col">Rentabilidade</th>
        </tr></thead>
        <tbody id="categorySummaryBody"></tbody>
      </table>
    </div>
  </div>

  <div class="charts-grid" style="display:grid;grid-template-columns:1fr 1fr;gap:20px;margin-bottom:30px;">
    <div id="profitChartContainer" style="display:none;background:#161b22;padding:20px;border-radius:10px;">
      <h2>Lucro Realizado vs Aberto</h2>
      <canvas id="profitChart"></canvas>
    </div>
    <div id="patrimonioChartContainer" style="display:none;background:#161b22;padding:20px;border-radius:10px;">
      <h2>ComposiÃ§Ã£o do PatrimÃ´nio</h2>
      <canvas id="patrimonioChart"></canvas>
    </div>
  </div>
</div>

<!-- ABA ATIVOS ATUAIS -->
<div id="ativos" class="tab-content">
  <div class="filtro-container">
    <label>Categoria:
      <select id="filterCategoryAtivos" onchange="filterCurrentAssets()">
        <option value="">Todas</option>
      </select>
    </label>
    <label>Ativo:
      <input type="text" id="filterSymbolAtivos" placeholder="Ex: SBUB11" onkeyup="filterCurrentAssets()">
    </label>
    <button onclick="document.getElementById('filterCategoryAtivos').value=''; document.getElementById('filterSymbolAtivos').value=''; filterCurrentAssets();">Limpar Filtros</button>
  </div>
  <div class="table-container">
    <table>
      <thead><tr>
        <th>Ativo</th><th>Categoria</th><th class="num-col">Qtd Atual</th><th class="num-col">Qtd Comprada</th><th class="num-col">Qtd Vendida</th>
        <th class="num-col">PreÃ§o MÃ©dio</th><th class="num-col">PreÃ§o Atual</th><th class="num-col">Custo PosiÃ§Ã£o</th><th class="num-col">Valor Atual</th>
        <th class="num-col">Lucro Realizado</th><th class="num-col">Lucro Aberto</th><th class="num-col">Rentabilidade</th>
      </tr></thead>
      <tbody id="assetsBody"></tbody>
    </table>
  </div>

  <div class="details-section" id="detailsSection" style="display:none;">
    <h2>ğŸ“ˆ Detalhes por Ativo</h2>
    <div id="assetDetails"></div>
  </div>
</div>

<!-- ABA TODOS OS ATIVOS -->
<div id="todos" class="tab-content">
  <div class="filtro-container">
    <label>Categoria:
      <select id="filterCategory" onchange="filterAllAssets()">
        <option value="">Todas</option>
      </select>
    </label>
    <label>Ativo:
      <input type="text" id="filterSymbol" placeholder="Ex: SBUB11" onkeyup="filterAllAssets()">
    </label>
    <button onclick="document.getElementById('filterCategory').value=''; document.getElementById('filterSymbol').value=''; filterAllAssets();">Limpar Filtros</button>
  </div>
  <div class="table-container">
    <table>
      <thead><tr>
        <th>Ativo</th><th>Categoria</th><th class="num-col">Qtd Atual</th><th class="num-col">Qtd Comprada</th><th class="num-col">Qtd Vendida</th>
        <th class="num-col">PreÃ§o MÃ©dio Compra</th><th class="num-col">PreÃ§o MÃ©dio Venda</th><th class="num-col">Total Investido</th><th class="num-col">Total Recuperado</th>
        <th class="num-col">Lucro Realizado</th><th class="num-col">Lucro Aberto</th><th class="num-col">Valor Atual</th><th class="num-col">Lucro Total</th><th class="num-col">Rentabilidade Total</th>
      </tr></thead>
      <tbody id="allAssetsBody"></tbody>
    </table>
  </div>
</div>

<!-- ABA TRADES REALIZADOS -->
<div id="trades" class="tab-content">
  <div class="filtro-container">
    <label>Filtrar por ativo: <input type="text" id="filterAsset" placeholder="Ex: SBUB11" onkeyup="filterTrades()"></label>
    <button onclick="document.getElementById('filterAsset').value=''; filterTrades();">Limpar Filtro</button>
  </div>
  <div id="tradesContainer"></div>
</div>

<!-- ABA HISTÃ“RICO COMPLETO -->
<div id="historico" class="tab-content">
  <div class="table-container">
    <table id="transactionsTable">
      <thead><tr>
        <th>#</th><th>Data</th><th>Ativo</th><th>Tipo</th><th class="num-col">Qtd</th><th class="num-col">PreÃ§o Unit.</th>
        <th class="num-col">Custos</th><th class="num-col">Total TransaÃ§Ã£o</th><th>Categoria</th><th class="num-col">Qtd em Carteira</th>
        <th class="num-col">Lucro Realizado Acum.</th><th class="num-col">Caixa Acumulado</th>
      </tr></thead>
      <tbody id="transactionsBody"></tbody>
    </table>
  </div>
</div>

</div>

<script type="module" src="js/main.js"></script>
</body>
</html>
