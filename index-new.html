<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Portfolio Manager - Swing Trade</title>
  <link rel="stylesheet" href="styles-new.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <!-- Biblioteca XLSX para importar/exportar Excel -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
</head>
<body>
  <div class="app-container">
    <!-- HEADER -->
    <header class="app-header">
      <h1 class="app-title">ğŸ“ˆ Portfolio Manager</h1>
      <p class="app-subtitle">GestÃ£o inteligente de investimentos em Swing Trade</p>
    </header>

    <!-- TOOLBAR -->
    <div class="toolbar">
      <div class="toolbar-section">
        <button class="btn btn-primary" onclick="openBatchModal()">
          â• Cadastro em Lote
        </button>
        <button class="btn btn-success" onclick="openSingleTransactionModal()">
          ğŸ“ Nova TransaÃ§Ã£o
        </button>
        <button class="btn btn-secondary" onclick="importExcel()">
          ğŸ“¥ Importar Excel
        </button>
      </div>
      <div class="toolbar-section">
        <button class="btn btn-secondary" onclick="updatePrices()">
          ğŸ”„ Atualizar PreÃ§os
        </button>
        <button class="btn btn-secondary" onclick="exportData()">
          ğŸ“¤ Exportar
        </button>
      </div>
    </div>

    <!-- STATUS MESSAGE -->
    <div id="statusMessage" class="status-message hidden"></div>

    <!-- SUMMARY CARDS -->
    <div class="summary-grid" id="summaryCards">
      <!-- Cards serÃ£o inseridos aqui via JS -->
    </div>

    <!-- TABS -->
    <div class="tabs">
      <button class="tab-btn active" onclick="switchTab('dashboard')">ğŸ“Š Dashboard</button>
      <button class="tab-btn" onclick="switchTab('ativos')">ğŸ’¼ Ativos</button>
      <button class="tab-btn" onclick="switchTab('transacoes')">ğŸ“‹ TransaÃ§Ãµes</button>
      <button class="tab-btn" onclick="switchTab('proventos')">ğŸ’° Proventos</button>
      <button class="tab-btn" onclick="switchTab('rendaFixa')">ğŸ¦ Renda Fixa</button>
    </div>

    <!-- TAB: DASHBOARD -->
    <div id="dashboard" class="tab-content active">
      <div class="table-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ“Š VisÃ£o Geral da Carteira</h2>
        </div>
        <div id="dashboardContent">
          <!-- GrÃ¡ficos e tabelas resumo -->
        </div>
      </div>
    </div>

    <!-- TAB: ATIVOS -->
    <div id="ativos" class="tab-content">
      <div class="table-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ’¼ Meus Ativos</h2>
          <button class="btn btn-secondary btn-sm" onclick="filterAtivos()">ğŸ” Filtrar</button>
        </div>
        <div class="spreadsheet-wrapper">
          <table class="spreadsheet-table">
            <thead>
              <tr>
                <th>Ativo</th>
                <th>Categoria</th>
                <th class="text-right">Quantidade</th>
                <th class="text-right">PreÃ§o MÃ©dio</th>
                <th class="text-right">PreÃ§o Atual</th>
                <th class="text-right">Valor Total</th>
                <th class="text-right">Lucro/PrejuÃ­zo</th>
                <th class="text-right">%</th>
                <th>AÃ§Ãµes</th>
              </tr>
            </thead>
            <tbody id="ativosTableBody">
              <!-- Linhas serÃ£o inseridas via JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: TRANSAÃ‡Ã•ES -->
    <div id="transacoes" class="tab-content">
      <div class="table-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ“‹ HistÃ³rico de TransaÃ§Ãµes</h2>
        </div>
        <div class="spreadsheet-wrapper">
          <table class="spreadsheet-table">
            <thead>
              <tr>
                <th>Data</th>
                <th>Ativo</th>
                <th>Tipo</th>
                <th class="text-right">Quantidade</th>
                <th class="text-right">PreÃ§o</th>
                <th class="text-right">Custos</th>
                <th class="text-right">Total</th>
                <th>Categoria</th>
                <th>AÃ§Ãµes</th>
              </tr>
            </thead>
            <tbody id="transacoesTableBody">
              <!-- Linhas serÃ£o inseridas via JS -->
            </tbody>
          </table>
        </div>
      </div>
    </div>

    <!-- TAB: PROVENTOS -->
    <div id="proventos" class="tab-content">
      <div class="table-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ’° Proventos Recebidos</h2>
          <button class="btn btn-success btn-sm" onclick="addProvento()">â• Adicionar</button>
        </div>
        <div id="proventosContent">
          <!-- ConteÃºdo de proventos -->
        </div>
      </div>
    </div>

    <!-- TAB: RENDA FIXA -->
    <div id="rendaFixa" class="tab-content">
      <div class="table-section">
        <div class="section-header">
          <h2 class="section-title">ğŸ¦ Renda Fixa</h2>
          <button class="btn btn-success btn-sm" onclick="addRendaFixa()">â• Adicionar</button>
        </div>
        <div id="rendaFixaContent">
          <!-- ConteÃºdo de renda fixa -->
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: CADASTRO EM LOTE -->
  <div id="batchModal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title">â• Cadastro em Lote de TransaÃ§Ãµes</h2>
        <button class="btn-icon" onclick="closeBatchModal()">âœ•</button>
      </div>

      <div class="status-message info">
        ğŸ’¡ Preencha as transaÃ§Ãµes abaixo. Clique em "Adicionar Linha" para mais operaÃ§Ãµes.
      </div>

      <div class="spreadsheet-wrapper">
        <table class="spreadsheet-table" id="batchTable">
          <thead>
            <tr>
              <th style="width: 120px;">Data</th>
              <th style="width: 100px;">Ativo</th>
              <th style="width: 80px;">Tipo</th>
              <th style="width: 100px;">Quantidade</th>
              <th style="width: 100px;">PreÃ§o (R$)</th>
              <th style="width: 100px;">Custos (R$)</th>
              <th style="width: 120px;">Categoria</th>
              <th style="width: 60px;">AÃ§Ãµes</th>
            </tr>
          </thead>
          <tbody id="batchTableBody">
            <!-- Linhas iniciais -->
          </tbody>
        </table>
      </div>

      <div style="margin-top: 1rem;">
        <button class="btn btn-secondary" onclick="addBatchRow()">â• Adicionar Linha</button>
        <button class="btn btn-secondary" onclick="clearBatchTable()">ğŸ—‘ï¸ Limpar Tudo</button>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeBatchModal()">Cancelar</button>
        <button class="btn btn-success" onclick="saveBatchTransactions()">ğŸ’¾ Salvar Todas</button>
      </div>
    </div>
  </div>

  <!-- MODAL: TRANSAÃ‡ÃƒO ÃšNICA -->
  <div id="singleTransactionModal" class="modal">
    <div class="modal-content" style="max-width: 600px;">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ“ Nova TransaÃ§Ã£o</h2>
        <button class="btn-icon" onclick="closeSingleTransactionModal()">âœ•</button>
      </div>

      <form id="singleTransactionForm">
        <div class="form-group">
          <label class="form-label">Data da OperaÃ§Ã£o</label>
          <input type="date" class="form-input" id="singleDate" required>
        </div>

        <div class="form-group">
          <label class="form-label">CÃ³digo do Ativo</label>
          <input type="text" class="form-input" id="singleAtivo" placeholder="Ex: PETR4" required style="text-transform: uppercase;">
        </div>

        <div class="form-group">
          <label class="form-label">Tipo</label>
          <select class="form-select" id="singleTipo" required>
            <option value="">Selecione...</option>
            <option value="C">Compra</option>
            <option value="V">Venda</option>
          </select>
        </div>

        <div class="form-group">
          <label class="form-label">Quantidade</label>
          <input type="number" class="form-input" id="singleQtd" step="0.01" required>
        </div>

        <div class="form-group">
          <label class="form-label">PreÃ§o UnitÃ¡rio (R$)</label>
          <input type="number" class="form-input" id="singlePreco" step="0.01" required>
        </div>

        <div class="form-group">
          <label class="form-label">Custos/Taxas (R$)</label>
          <input type="number" class="form-input" id="singleCustos" step="0.01" value="0">
        </div>

        <div class="form-group">
          <label class="form-label">Categoria</label>
          <select class="form-select" id="singleCategoria">
            <option value="">Selecione...</option>
            <option value="AÃ§Ãµes">AÃ§Ãµes</option>
            <option value="FIIs">FIIs</option>
            <option value="ETFs">ETFs</option>
            <option value="BDRs">BDRs</option>
            <option value="Stocks">Stocks</option>
            <option value="REITs">REITs</option>
            <option value="Cripto">Criptomoedas</option>
            <option value="Outros">Outros</option>
          </select>
        </div>
      </form>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeSingleTransactionModal()">Cancelar</button>
        <button class="btn btn-success" onclick="saveSingleTransaction()">ğŸ’¾ Salvar</button>
      </div>
    </div>
  </div>

  <!-- MODAL: PROVENTOS -->
  <div id="proventosModal" class="modal">
    <div class="modal-content" style="max-width: 700px;">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ’° Adicionar Provento</h2>
        <button class="btn-icon" onclick="closeProventosModal()" title="Fechar">âœ•</button>
      </div>

      <form id="proventosForm">
        <div class="form-grid">
          <div class="form-group">
            <label class="form-label">Ativo *</label>
            <input type="text" class="form-input input-uppercase" id="proventoAtivo" placeholder="Ex: PETR4" title="CÃ³digo do ativo" required>
          </div>

          <div class="form-group">
            <label class="form-label">Tipo *</label>
            <select class="form-select" id="proventoTipo" title="Tipo de provento" required>
              <option value="">Selecione...</option>
              <option value="Dividendo">ğŸ’µ Dividendo</option>
              <option value="JCP">ğŸ“Š JCP</option>
              <option value="Rendimento">ğŸ’° Rendimento</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Valor UnitÃ¡rio (R$) *</label>
            <input type="number" class="form-input" id="proventoValorUnitario" step="0.0001" required placeholder="0.00" title="Valor por aÃ§Ã£o" oninput="calcularTotalProvento()">
          </div>

          <div class="form-group">
            <label class="form-label">Quantidade de AÃ§Ãµes *</label>
            <input type="number" class="form-input" id="proventoQuantidade" step="1" required placeholder="100" title="Quantas aÃ§Ãµes vocÃª tinha" oninput="calcularTotalProvento()">
          </div>

          <div class="form-group">
            <label class="form-label">Data COM *</label>
            <input type="date" class="form-input" id="proventoDataCom" required title="Data em que tinha as aÃ§Ãµes">
            <small class="form-help">Data em que tinha as aÃ§Ãµes</small>
          </div>

          <div class="form-group">
            <label class="form-label">Data de Pagamento *</label>
            <input type="date" class="form-input" id="proventoDataPagamento" required title="Data do recebimento">
            <small class="form-help">Data que recebeu o valor</small>
          </div>
        </div>

        <div class="form-total-box">
          <div class="form-total-label">Total a Receber</div>
          <div class="form-total-value" id="proventoTotalValue">R$ 0,00</div>
        </div>
      </form>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeProventosModal()">Cancelar</button>
        <button class="btn btn-success" onclick="saveProvento()">ğŸ’¾ Salvar Provento</button>
      </div>
    </div>
  </div>

  <!-- MODAL: RENDA FIXA -->
  <div id="rendaFixaModal" class="modal">
    <div class="modal-content" style="max-width: 800px;">
      <div class="modal-header">
        <h2 class="modal-title">ğŸ¦ Adicionar Investimento Renda Fixa</h2>
        <button class="btn-icon" onclick="closeRendaFixaModal()" title="Fechar">âœ•</button>
      </div>

      <form id="rendaFixaForm">
        <div class="form-grid">
          <div class="form-group form-grid-full-width">
            <label class="form-label">Nome do Investimento *</label>
            <input type="text" class="form-input" id="rendaFixaNome" placeholder="Ex: CDB Banco Inter 110% CDI" title="Nome descritivo do investimento" required>
          </div>

          <div class="form-group">
            <label class="form-label">Tipo *</label>
            <select class="form-select" id="rendaFixaTipo" title="Tipo de investimento renda fixa" required onchange="atualizarCamposRendaFixa()">
              <option value="">Selecione...</option>
              <option value="CDB">ğŸ¦ CDB</option>
              <option value="LCI">ğŸ  LCI (Isento de IR)</option>
              <option value="LCA">ğŸŒ¾ LCA (Isento de IR)</option>
              <option value="Tesouro Selic">ğŸ“Š Tesouro Selic</option>
              <option value="Tesouro IPCA+">ğŸ“ˆ Tesouro IPCA+</option>
              <option value="Tesouro Prefixado">ğŸ“‰ Tesouro Prefixado</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">InstituiÃ§Ã£o Financeira</label>
            <input type="text" class="form-input" id="rendaFixaInstituicao" placeholder="Ex: Banco Inter" title="Qual banco ou instituiÃ§Ã£o">
          </div>

          <div class="form-group">
            <label class="form-label">Valor Investido (R$) *</label>
            <input type="number" class="form-input" id="rendaFixaValor" step="0.01" required placeholder="10000.00" title="Valor inicial investido" oninput="atualizarPreviewRendaFixa()">
          </div>

          <div class="form-group">
            <label class="form-label" id="rendaFixaTaxaLabel">Taxa (% do CDI) *</label>
            <input type="number" class="form-input" id="rendaFixaTaxa" step="0.01" required placeholder="110" title="Taxa de rendimento" oninput="atualizarPreviewRendaFixa()">
            <small id="rendaFixaTaxaHelp" class="form-help">Para CDB/LCI/LCA: % do CDI (ex: 110)</small>
          </div>

          <div class="form-group">
            <label class="form-label">Data de InÃ­cio *</label>
            <input type="date" class="form-input" id="rendaFixaDataInicio" required title="Quando comeÃ§ou o investimento" oninput="atualizarPreviewRendaFixa()">
          </div>

          <div class="form-group">
            <label class="form-label">Data de Vencimento</label>
            <input type="date" class="form-input" id="rendaFixaDataVencimento" title="Data do vencimento" oninput="atualizarPreviewRendaFixa()">
            <small class="form-help">Deixe em branco se nÃ£o houver</small>
          </div>

          <div class="form-group">
            <label class="form-label">Liquidez</label>
            <select class="form-select" id="rendaFixaLiquidez" title="Tipo de liquidez">
              <option value="DiÃ¡ria">ğŸ’§ Liquidez DiÃ¡ria</option>
              <option value="Vencimento">ğŸ”’ Apenas no Vencimento</option>
            </select>
          </div>

          <div class="form-group form-grid-full-width">
            <label class="form-label">ObservaÃ§Ãµes</label>
            <textarea class="form-input form-textarea" id="rendaFixaObs" rows="2" placeholder="InformaÃ§Ãµes adicionais..." title="Notas adicionais"></textarea>
          </div>
        </div>

        <div id="rendaFixaPreview" class="form-preview">
          <h4 class="form-preview-title">ğŸ“Š ProjeÃ§Ã£o Atual</h4>
          <div id="rendaFixaPreviewContent" class="form-preview-grid"></div>
        </div>
      </form>

      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeRendaFixaModal()">Cancelar</button>
        <button class="btn btn-success" onclick="saveRendaFixa()">ğŸ’¾ Salvar Investimento</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/app-new.js"></script>
</body>
</html>
